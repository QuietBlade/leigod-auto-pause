<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}Token 服务{% endblock %}</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .status { background-color: #f5f5f5; padding: 10px; margin: 10px 0; }
        .history-item { padding: 5px; border-bottom: 1px solid #eee; }
        .timestamp { color: #666; font-size: 0.9em; }
        .refresh-timer { 
            text-align: center; 
            margin-top: 15px; 
            font-size: 0.9em; 
            color: #555; 
            background-color: #e0f7fa; /* 浅蓝色背景 */
            padding: 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <h1>雷神加速器 暂停管理服务</h1>
    </header>

    <div>
        1. 访问 <a href="https://www.leigod.com/" class="href">雷神加速器 - 官网</a>
    </div>

    <code></code>
    
    <main>
        <div class="card">
            <h2>Token 更新</h2>
            <form method="post" action="/update-token">
                <label for="token">新 Token 值:</label>
                <input type="text" id="token" name="token" required 
                        placeholder="输入新 token..." value="">
                <button type="submit">更新 Token</button>
            </form>
            
            <div class="status">
                <h3>当前状态</h3>
                <p>Token 值: <code>{{ current_token }}</code></p>
                <p>昵称: <span>{{ nickname }}</span></p>
                <p>状态信息: <span>{{ status_message }}</span></p>
                
                <form method="post" action="/pause">
                    <button type="submit">暂停加速</button>
                </form>
            </div>
        </div>

        <div class="card">
            <h2>历史记录</h2>
            <div class="history-list">
                {% if history %}
                    {% for item in history %}
                    <div class="history-item">
                        <span class="timestamp">{{ item.time }}</span>
                        <span class="token-value">{{ item.token }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>暂无历史记录</p>
                {% endif %}
            </div>
            
            <form method="post" action="/reset">
                <button type="submit">重置状态</button>
            </form>
        </div>
    </main>
    
    <footer>
        <p>服务状态: <strong>{{ status_message }}</strong></p>
        <p>最后更新: {{ last_update_time or "从未更新" }}</p>
        <div class="refresh-timer">
            页面将在 <span id="countdown"></span> 秒后刷新...
        </div>
    </footer>

    <script>
        const REFRESH_INTERVAL = 5; // 刷新间隔，单位秒
        let countdown = REFRESH_INTERVAL;
        const countdownElement = document.getElementById('countdown');

        function updateCountdown() {
            countdownElement.textContent = countdown;
            if (countdown === 0) {
                window.location.reload(); // 刷新页面
            } else {
                countdown--;
                setTimeout(updateCountdown, 1000); // 每秒更新倒计时
            }
        }

        // 页面加载完成后开始倒计时
        window.onload = function() {
            updateCountdown();
        };
    </script>
</body>
</html>